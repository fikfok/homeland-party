{% extends "base.html" %}
{% load static %}

{% block container %}
        <div id="content">
            {% block content %}
                <h1>Инициатива: "{{ initiative.initiative_label }}"</h1>
                <p>Текст инициативы:</p>
                <p>{{ initiative.initiative_text }}</p>
            {% endblock %}
        </div>
{% endblock container %}


{% block scripts %}
    <script type="application/javascript">

        $('#createGeoTenInitiativeClose').on('click', function(event) {
            $('#createGeoTenInitiativeModal').modal('hide');
        });

        $('#simpleModalClose, #simpleModalOk').on('click', function(event) {
            document.location.reload();
        });

        $('#createGeoTenInitiativeOk').on('click', function(event) {
            $('#createGeoTenInitiativeModal').modal('hide');
            var initiativeLabel = $('#initiativeLabel').val();
            var initiativeText = $('#initiativeText').val();

            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    var key = document.querySelector("[name=csrfmiddlewaretoken]").value;
                    xhr.setRequestHeader('X-CSRFToken', key);
                }
            });

            $.ajax({
                type: 'POST',
                url: '{% url 'veche:geo_ten_initiatives' %}',
                data: {'label': initiativeLabel, 'text': initiativeText},
                success: function (response) {
                    $('#simpleModalHeader').removeClass('bg-danger');
                    $('#simpleModalHeader h4').text('Инициатива успешно создана');
                    $('#simpleModalMessage').text('Инициатива успешно создана');
                    $('#simpleModal').modal('show');
                },
                error: function (response) {
                    var message = response.responseJSON.message ? response.responseJSON.message : 'Ошибка при создании инициативы';
                    $('#simpleModalHeader').addClass('bg-danger');
                    $('#simpleModalHeader h4').text('Инициатива не создана');
                    $('#simpleModalMessage').text(message);
                    $('#simpleModal').modal('show');
                }
            })
        });

        $('#createGeoTenInitiativeButton').on('click', function(event) {
            $('#createGeoTenInitiativeModal').modal('show')
        })

        $("#initiativeLabel, #initiativeText").on('change keyup paste', function() {
            if($('#initiativeLabel').val().length * $('#initiativeText').val().length === 0 ){
                $('#createGeoTenInitiativeOk').addClass('disabled');
            } else {
                $('#createGeoTenInitiativeOk').removeClass('disabled');
            }
        });

    </script>
{% endblock scripts %}